echo "ğŸ” Running pre-commit checks..."

# Get staged .js and .ts files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(js|ts)$' | tr '\n' ' ')

if [ -z "$STAGED_FILES" ]; then
  echo "â†’ No staged files match any configured task."
  exit 0
fi

echo "ğŸ”§ Running ESLint with auto-fix on staged files..."
npx eslint --fix $STAGED_FILES
if [ $? -ne 0 ]; then
  echo "âŒ ESLint failed. Please fix the issues before committing."
  exit 1
fi

echo "ğŸ” Running TypeScript type check..."
npx tsc --noEmit
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript type check failed. Please fix the issues before committing."
  exit 1
fi

# Re-add files that may have been auto-fixed by ESLint
git add $STAGED_FILES

echo "âœ… Pre-commit checks passed!"
